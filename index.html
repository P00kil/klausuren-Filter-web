<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kursauswahl und Klausurtermine</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }

        .container {
            margin: 400px;
            max-width: 150px;
        }

        select {
            width: 100%;
            height: 200px;
            font-size: 16px;
        }

        button {
            margin-top: 10px;
            padding: 10px 15px;
            font-size: 16px;
        }

        h1, h2 {
            font-size: 20px;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>Klausurtermine Filter</h1>
    
    <h2>Wähle deine Kurse aus:</h2>
    <form id="courseForm">
        <select id="courseSelect" multiple>
            <option value="BIO1 - Ba.S">BIO1 - Ba.S</option>
            <option value="bio1 - Be.B">bio1 - Be.B</option>
            <option value="bio2 - St.Fr">bio2 - St.Fr</option>
            <option value="ch1 - Dr.N">ch1 - Dr.N</option>
            <option value="CH1 - Pi.G">CH1 - Pi.G</option>
            <option value="ch2 - St.Fr">ch2 - St.Fr</option>
            <option value="de1 - Fö.E">de1 - Fö.E</option>
            <option value="DE1 - Pe.M">DE1 - Pe.M</option>
            <option value="de2 - Ku.Ka">de2 - Ku.Ka</option>
            <option value="de3 - Ku.Ka">de3 - Ku.Ka</option>
            <option value="de4 - Le.S">de4 - Le.S</option>
            <option value="EN1 - Am.U">EN1 - Am.U</option>
            <option value="en1 - Re.S">en1 - Re.S</option>
            <option value="en2 - Fr.K">en2 - Fr.K</option>
            <option value="EN2 - Re.S">EN2 - Re.S</option>
            <option value="ere1 - Be.R">ere1 - Be.R</option>
            <option value="ere2 - Ro.D">ere2 - Ro.D</option>
            <option value="GE1 - Ha.T">GE1 - Ha.T</option>
            <option value="ge1 - Se.M">ge1 - Se.M</option>
            <option value="ge2 - Ne.M">ge2 - Ne.M</option>
            <option value="ge3 - He.F">ge3 - He.F</option>
            <option value="ge4 - Ha.J">ge4 - Ha.J</option>
            <option value="geo1 - De.A">geo1 - De.A</option>
            <option value="geo2 - Ge.N">geo2 - Ge.N</option>
            <option value="geo3 - Am.U">geo3 - Am.U</option>
            <option value="inf1 - Sc.C">inf1 - Sc.C</option>
            <option value="inf2 - Sc.C">inf2 - Sc.C</option>
            <option value="ku1 - Ec.U">ku1 - Ec.U</option>
            <option value="KU1 - Fö.E">KU1 - Fö.E</option>
            <option value="ku2 - Sc.S">ku2 - Sc.S</option>
            <option value="la1 - Ro.D">la1 - Ro.D</option>
            <option value="ma1 - Dr.N">ma1 - Dr.N</option>
            <option value="MA1 - Ge.J">MA1 - Ge.J</option>
            <option value="ma2 - Ge.J">ma2 - Ge.J</option>
            <option value="MA2 - Pa.N">MA2 - Pa.N</option>
            <option value="ma3 - Hi.F">ma3 - Hi.F</option>
            <option value="mu1 - Fr.K">mu1 - Fr.K</option>
            <option value="mu2 - Sc.C">mu2 - Sc.C</option>
            <option value="mue1 - Sc.C">mue1 - Sc.C</option>
            <option value="mue2 - Ki.P">mue2 - Ki.P</option>
            <option value="ph1 - Ge.J">ph1 - Ge.J</option>
            <option value="PH1 - Sa.L">PH1 - Sa.L</option>
            <option value="ph2 - Ka.W">ph2 - Ka.W</option>
            <option value="phil1 - Be.R">phil1 - Be.R</option>
            <option value="PHIL1 - St.F">PHIL1 - St.F</option>
            <option value="phil2 - Be.A">phil2 - Be.A</option>
            <option value="phil3 - Be.A">phil3 - Be.A</option>
            <option value="pro1 - Pa.N">pro1 - Pa.N</option>
            <option value="SK1 - Kr.T">SK1 - Kr.T</option>
            <option value="sk1 - Ku.Ka">sk1 - Ku.Ka</option>
            <option value="sk2 - St.M">sk2 - St.M</option>
            <option value="sk3 - He.F">sk3 - He.F</option>
            <option value="span1 - We.C">span1 - We.C</option>
            <option value="spj1 - Ge.N">spj1 - Ge.N</option>
            <option value="spm1 - Hi.F">spm1 - Hi.F</option>
            <option value="sps1 - Kr.T">sps1 - Kr.T</option>
            <option value="sps2 - Be.B">sps2 - Be.B</option>
            <option value="w1 - Sc.J">w1 - Sc.J</option>
            <option value="w2 - Kr.T">w2 - Kr.T</option>
            <option value="w3 - Kr.T">w3 - Kr.T</option>
        </select>

        <button type="button" onclick="getSelectedCourses()">Ausgewählte Kurse anzeigen</button>
    </form>

    <h3>PDF-Datei mit Klausurterminen:</h3>
    <input type="file" id="pdfFile" accept="application/pdf" />

    <button id="processButton">Termine anzeigen</button>

    <h3>Gefundene Klausurtermine:</h3>
    <ul id="examDates">
        <!-- Hier werden die Klausurtermine angezeigt -->
    </ul>

    <p id="output"></p>
</div>

<script>
    // Funktion zur Anzeige der ausgewählten Kurse
    function getSelectedCourses() {
        const selectedOptions = document.getElementById('courseSelect').selectedOptions;
        const selectedValues = Array.from(selectedOptions).map(option => option.value);
        document.getElementById('output').innerText = "Ausgewählte Kurse: " + selectedValues.join(', ');
    }

    // PDF.js laden
    const pdfjsLib = window['pdfjs-dist/build/pdf'];
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.6.347/pdf.worker.min.js';

    // Event-Listener für den Button "Termine anzeigen"
    document.getElementById('processButton').addEventListener('click', () => {
        const selectedOptions = document.getElementById('courseSelect').selectedOptions;
        const selectedCourses = Array.from(selectedOptions).map(option => option.value);
        const pdfFile = document.getElementById('pdfFile').files[0];

        if (selectedCourses.length > 0 && pdfFile) {
            extractExamDates(pdfFile, selectedCourses);
        } else {
            alert('Bitte Kurse auswählen und eine PDF-Datei hochladen.');
        }
    });

    // PDF-Inhalt extrahieren und nach Klausurterminen filtern
    async function extractExamDates(pdfFile, courses) {
        const pdf = await pdfjsLib.getDocument(URL.createObjectURL(pdfFile)).promise;
        let examDates = [];

        for (let i = 1; i <= pdf.numPages; i++) {
            const page = await pdf.getPage(i);
            const textContent = await page.getTextContent();
            const pageText = textContent.items.map(item => item.str).join(' ');

            courses.forEach(course => {
                if (pageText.includes(course)) {
                    const examInfo = findExamInfo(pageText, course);
                    if (examInfo) {
                        examDates.push(examInfo);
                    }
                }
            });
        }

        displayExamDates(examDates);
    }

    // Klausurtermine im Text finden
    function findExamInfo(text, course) {
        const courseIndex = text.indexOf(course);
        if (courseIndex !== -1) {
            return text.substring(courseIndex, courseIndex + 100); // Beispiel: 100 Zeichen ab dem Kursnamen extrahieren
        }
        return null;
    }

    // Gefundene Klausurtermine anzeigen
    function displayExamDates(dates) {
        const examDatesList = document.getElementById('examDates');
        examDatesList.innerHTML = '';

        if (dates.length > 0) {
            dates.forEach(date => {
                const li = document.createElement('li');
                li.textContent = date;
                examDatesList.appendChild(li);
            });
        } else {
            examDatesList.textContent = 'Keine Klausurtermine gefunden.';
        }
    }
</script>

</body>
</html>
